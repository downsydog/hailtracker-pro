{% extends "customer_portal/base.html" %}

{% block title %}Digital Flyers{% endblock %}

{% block content %}
<div class="p-6 lg:p-8">
    <div class="mb-6">
        <h1 class="text-2xl font-bold text-gray-800">Digital Flyers</h1>
        <p class="text-gray-500">Share personalized flyers to earn referral rewards</p>
    </div>

    <!-- My Flyers -->
    <div class="card p-6 mb-6">
        <div class="flex items-center justify-between mb-4">
            <h2 class="text-lg font-bold text-gray-800">
                <i data-lucide="image" class="w-5 h-5 inline mr-2 text-emerald-600"></i>My Personalized Flyers
            </h2>
            <a href="{{ url_for('customer_portal.flyer_analytics') }}" class="text-sm text-emerald-600 hover:underline">
                <i data-lucide="bar-chart-2" class="w-4 h-4 inline mr-1"></i>View Analytics
            </a>
        </div>

        {% if customer_flyers %}
        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
            {% for flyer in customer_flyers %}
            <div class="border border-gray-200 rounded-xl overflow-hidden hover:shadow-lg transition">
                <div class="h-40 bg-gradient-to-br from-emerald-400 to-teal-500 flex items-center justify-center">
                    <i data-lucide="image" class="w-16 h-16 text-white/50"></i>
                </div>
                <div class="p-4">
                    <h3 class="font-bold text-gray-800">{{ flyer.flyer_name or 'Referral Flyer' }}</h3>
                    <p class="text-sm text-gray-500 mt-1">Created: {{ flyer.generated_at or 'N/A' }}</p>

                    <div class="mt-4 flex space-x-2">
                        <a href="{{ flyer.flyer_url }}" target="_blank" class="flex-1 text-center bg-emerald-600 hover:bg-emerald-700 text-white py-2 rounded-lg text-sm transition">
                            <i data-lucide="eye" class="w-4 h-4 inline mr-1"></i>View
                        </a>
                        <button onclick="shareFlyer('{{ flyer.flyer_url }}')" class="flex-1 text-center bg-gray-100 hover:bg-gray-200 text-gray-700 py-2 rounded-lg text-sm transition">
                            <i data-lucide="share" class="w-4 h-4 inline mr-1"></i>Share
                        </button>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="text-center py-8 text-gray-500">
            <i data-lucide="image" class="w-14 h-14 text-gray-300 mb-3 mx-auto"></i>
            <p>You haven't created any flyers yet</p>
            <p class="text-sm mt-1">Generate a personalized flyer from the templates below</p>
        </div>
        {% endif %}
    </div>

    <!-- Available Templates -->
    <div class="card p-6">
        <h2 class="text-lg font-bold text-gray-800 mb-4">
            <i data-lucide="palette" class="w-5 h-5 inline mr-2 text-purple-600"></i>Available Templates
        </h2>

        {% if available_flyers %}
        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
            {% for flyer in available_flyers %}
            <div class="border border-gray-200 rounded-xl overflow-hidden hover:shadow-lg transition">
                <div class="h-40 bg-gradient-to-br from-purple-400 to-indigo-500 flex items-center justify-center">
                    <i data-lucide="image" class="w-16 h-16 text-white/50"></i>
                </div>
                <div class="p-4">
                    <h3 class="font-bold text-gray-800">{{ flyer.flyer_name }}</h3>
                    <p class="text-sm text-gray-500 mt-1">{{ flyer.flyer_type }}</p>

                    <form action="{{ url_for('customer_portal.generate_flyer', flyer_id=flyer.id) }}" method="POST" class="mt-4">
                        <button type="submit" class="w-full bg-purple-600 hover:bg-purple-700 text-white py-2 rounded-lg text-sm transition">
                            <i data-lucide="wand-2" class="w-4 h-4 inline mr-1"></i>Generate My Flyer
                        </button>
                    </form>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="text-center py-8 text-gray-500">
            <i data-lucide="palette" class="w-14 h-14 text-gray-300 mb-3 mx-auto"></i>
            <p>No templates available</p>
        </div>
        {% endif %}
    </div>
</div>

<script>
function shareFlyer(url) {
    if (navigator.share) {
        navigator.share({
            title: 'Check out this PDR service!',
            text: 'I had a great experience with this paintless dent repair service.',
            url: url
        });
    } else {
        // Fallback - copy to clipboard
        navigator.clipboard.writeText(url);
        alert('Link copied to clipboard!');
    }
}
</script>
{% endblock %}
